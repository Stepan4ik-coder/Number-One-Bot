"""
–•–µ–Ω–¥–ª–µ—Ä /join –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

–û–ü–ò–°–ê–ù–ò–ï:
–ú–æ–¥—É–ª—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã /join –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
–ë–æ—Ç —Å–æ–±–∏—Ä–∞–µ—Ç –∞–Ω–∫–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞—è–≤–∫—É –≤ WhatsApp.

–°–¢–†–£–ö–¢–£–†–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•:
- User: –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- Programme: –¢–∞–±–ª–∏—Ü–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º –æ–±—É—á–µ–Ω–∏—è

–ü–ï–†–ï–ú–ï–ù–ù–´–ï:
- user_id: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
- username: –ù–∏–∫–Ω–µ–π–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
- first_name: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/—Ä–µ–±–µ–Ω–∫–∞
- surname: –§–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/—Ä–µ–±–µ–Ω–∫–∞
- age: –í–æ–∑—Ä–∞—Å—Ç —Ä–µ–±–µ–Ω–∫–∞
- phone_number: –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ 8(***)*** ** **
- programme: –í—ã–±—Ä–∞–Ω–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –æ–±—É—á–µ–Ω–∏—è

–ò–ú–ü–û–†–¢–´:
- telebot.types.Message: –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è Telegram
- loader.bot: –≠–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞
- database.models: –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- .check_user_existance.check_exists: –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- keyboards.reply: –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
- pywhatkit: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ WhatsApp
"""

# –ò–º–ø–æ—Ä—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –º–æ–¥—É–ª–µ–π
from telebot.types import Message  # üì® –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è Telegram
from loader import bot  # ü§ñ –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞
from database import models  # üóÑÔ∏è –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
from .check_user_existance import check_exists  # ‚úÖ –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
from .get_user_information import get_first_name


@bot.message_handler(commands=["join"])
def join_to_number_one(message: Message):
    """
    üéØ –û–°–ù–û–í–ù–û–ô –•–ï–ù–î–õ–ï–†: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /join

    –ü–ê–†–ê–ú–ï–¢–†–´:
    - message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telegram

    –õ–û–ì–ò–ö–ê:
    1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç user_id –∏ username –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
    2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ check_exists()
    3. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–æ–≤—ã–π:
       - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î —Å phone_number='pending'
       - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
       - –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ get_first_name()
    4. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –∑–∞–≤–µ—Ä—à–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

    –ü–†–ò–ú–ï–† –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:
    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /join
    –ë–æ—Ç: "üéâ –ú—ã —Ä–∞–¥—ã, —á—Ç–æ –≤—ã –≥–æ—Ç–æ–≤—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ Number One!"
         "üë§ –í–∞—à–µ –∏–º—è (–∏–º—è —Ä–µ–±—ë–Ω–∫–∞): "
    """
    user_id = message.from_user.id  # üîë –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    username = message.from_user.username  # üë§ –ù–∏–∫–Ω–µ–π–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if check_exists(user_id, message):
        return True  # ‚èπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
    else:
        # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
        models.User.create(
            user_id=user_id,  # üîë ID Telegram
            username=username,  # üë§ –ù–∏–∫–Ω–µ–π–º
            phone_number='pending'  # ‚è≥ –í—Ä–µ–º–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
        )
        bot.send_message(message.chat.id, 'üéâ –ú—ã —Ä–∞–¥—ã, —á—Ç–æ –≤—ã –≥–æ—Ç–æ–≤—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ Number One!')

        # –ó–∞–ø—É—Å–∫ —Ü–µ–ø–æ—á–∫–∏ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
        first_name = bot.send_message(message.chat.id, 'üë§ –í–∞—à–µ –∏–º—è (–∏–º—è —Ä–µ–±—ë–Ω–∫–∞): ')
        bot.register_next_step_handler(first_name, get_first_name)  # ‚û°Ô∏è –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
        return None



